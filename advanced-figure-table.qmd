---
echo: false
---

# Advanced figures and tables {#sec-adv-figures-and-tables}
```{r}
#| eval: false
#| include: false

## Occasionally run this re-generate screenshots
source("_examples/adv-figure-table/generate-screenshots.R")
```
```{r}
#| include: false
{{< include _examples/figure-table/_code-snippets/setup.R >}}
```

## Overview

Regardless of where figures and tables are coming from.

Advanced layout:
  - Layout: `layout` code cell options, `layout` attribute 
  - Cross-references
  - Captions

Prefer longer, more explicit, and more general syntax, over more succinct but less general.

## Generalizing the examples in this chapter

We'll use markdown examples.
Anywhere you see a markdown figure:
  - substitute with computational figure.
  - substitute with table 


## Syntax Variations

@fig-tbl-compare and @fig-fig-compare compare the syntax for non-computational and computational tables and figures using placeholders (in uppercase) for the content.

::: {#fig-tbl-compare}

:::{}
```{.markdown}
MARKDOWN TABLE

: CAPTION {#LABEL}
```

Markdown table

:::

:::{}
````{.markdown}
```{{LANGUAGE}}
#| label: LABEL
#| tbl-cap: CAPTION

# CODE
```
````

Computational table
:::

A comparison of the syntax for a table created with markdown, and a table created in a code cell. TODO: turn this into a diagram so we can color code the same info

::: 

::: {#fig-fig-compare}

:::{}
```{.markdown}
![CAPTION](PATH){#LABEL fig-alt="ALT TEXT"}
```

Markdown figure
:::

:::{}
````{.markdown}
```{{LANGUAGE}}
#| label: LABEL
#| fig-cap: CAPTION
#| fig-alt: ALT TEXT

# CODE
```
````

Computational figure

:::

A comparison of the syntax for a figure created with markdown, and a figure created in a code cell.  TODO: turn this into a diagram so we can color code the same info

::: 

As a concrete example, consider the non-computational table in @lst-markdown-table.

:::{#lst-markdown-table}
```{.markdown .code-overflow-wrap}
| species    | n   |
|------------|-----|
| Adelie     | 152 |
| Chinstrap  | 68  |
| Gentoo     | 124 |

: Number of penguins sampled from each species in the Palmer Archipelago {#tbl-species-count}
```

Markdown to produce a captioned and numbered table
:::

This table could have instead been produced by an executable code cell, as shown in @fig-tables.

::: {#fig-tables}

::: {.panel-tabset group="language"}

## R

````{.markdown}
```{{r}}
#| label: tbl-species-count
#| tbl-cap: "Number of penguins sampled from each species in the Palmer Archipelago"

{{< include _examples/figure-table/_code-snippets/species-count.R >}}
```
````

## Python

````{.markdown}
```{{python}}
#| label: tbl-species-count
#| tbl-cap: "Number of penguins sampled from each species in the Palmer Archipelago"

{{< include _examples/figure-table/_code-snippets/species-count.py >}}
```
````

:::

Basic table chunk options used for a computational table. Compare to @lst-markdown-table

:::

When rendered the result is shown in @fig-basic-cell-options-table.
Notice the caption is prefaced by "Table 1:" --- this is because the label started with `tbl-` which signals to Quarto this is a cross-referenceable table. 
You'll learn more about cross-references in @sec-figtab-crossrefs.

![Example output when @fig-tables is rendered](images/figure-table-basic-cell-options-table.png){#fig-basic-cell-options-table fig-alt=""}


Similarly, @lst-markdown-figure shows a non-computational figure, that could instead be produced using the code cells shown in @fig-figures.

::: {#lst-markdown-figure}

```{.markdown .code-overflow-wrap}
![Penguin bill length versus depth by species](images/width-vs-depth.png){#fig-scatter fig-alt="Scatter plot of bill length vs. depth showing distinct species clustering."}
```

Markdown used to include a non-computational figure.
:::

::: {#fig-figures}

::: {.panel-tabset group="language"}

## R

````{.markdown}
```{{r}}
#| label: fig-scatter
#| fig-cap: "Penguin bill length versus depth by species"
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```
````

## Python

````{.markdown}
```{{python}}
#| label: fig-scatter
#| fig-cap: "Penguin bill length versus depth by species"
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```
````

:::

Basic figure chunk options used for a computational figure. Compare to @lst-markdown-figure.

:::

The result is shown in @fig-basic-cell-options-figure.
The caption here is prefaced by "Figure 1:" because the label started with `fig-`, the signal that this is a cross-referenceable figure. 

![Example output when @fig-figures is rendered](images/figure-table-basic-cell-options-figure.png){#fig-basic-cell-options-figure fig-alt=""}



### Fenced div syntax

Alternative to setting `label` and `fig-cap`/`tbl-cap` as code cell options
Set identifier as ID in fenced div
Use code cell to generate table or figure
Caption is last line in div

```{.markdown}
::: {#LABEL}

CONTENT

CAPTION

:::
```

::: {.panel-tabset group="language"}

## R

````{.markdown}
::: {#fig-scatter} 
```{{r}} 
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```

Penguin bill length versus depth by species

:::
````

## Python

````{.markdown}
::: {#fig-scatter}
```{{python}}
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```

Penguin bill length versus depth by species

:::
````

:::


## Captions {#sec-captions}

### Caption text

Refer to previous sections:

* Use code cell options or last element in fenced divs to set content of captions.
* Include dynamic content in captions by using div syntax and inline code.

### Caption location {#sec-caption-location}

By default, Quarto puts figure captions at the bottom of the figure, and table captions at the top of the table.
You can control this with the `cap-location` option for both figures and tables, or separately with the `fig-cap-location` and `tbl-cap-location` options.
Can take the values `top`, `bottom`, or `margin` (`margin` only in some formats).

Document level to control computational and non-computational figures and tables.

Code cell level for individual figures and tables.

Is there an attribute equivalent for markdown figures and tables?

::: {.panel-tabset group="language"}

## R
 
````{.markdown filename="document.qmd"}
```{{r}}
#| label: tbl-species-count
#| tbl-cap: "Penguins sampled from the Palmer Archipelago"
#| cap-location: bottom

{{< include _examples/figure-table/_code-snippets/species-count.R >}}
``` 
````
 
## Python
 
````{.markdown filename="document.qmd"}
```{{python}}
#| label: tbl-species-count
#| tbl-cap: "Penguins sampled from the Palmer Archipelago"
#| cap-location: bottom

{{< include _examples/figure-table/_code-snippets/species-count.py >}}
``` 
````
 
:::

For example,

::: {#fig-cap-location}

:::{layout="[[1,1], [1]]"}
:::{}
![](images/figure-table-captions-location-top.png){.border}

`top`
:::
:::{}
![](images/figure-table-captions-location-bottom.png){.border}

`bottom`
:::

:::{}
![](images/figure-table-captions-location-margin.png){.border}

`margin`
:::
:::

Tables with the code cell option `cap-location` set to: `top`, `bottom` and `margin`.

:::


::: {#fig-cap-location-document}

:::{layout-ncol="2"}
```{.yaml filename="document.qmd"}
---
title: "My Document"
cap-location: bottom
---
```

```{.yaml filename="_quarto.yml"}
cap-location: bottom
```
:::

You can set the caption location for the entire document in the document header, or for all documents in a project using `_quarto.yml`.

:::

### Caption titles and numbering

Document level (or project level options)!

:::{#fig-cap-title}

::: {layout="[2, 1]"}
:::{}
![](images/figure-table-caption-format.jpeg){.border width="50%"}

Table Caption
:::

:::{}
![](images/figure-table-cross-reference-form.jpeg){.border width="50%"}

Inline reference
:::

:::
:::

```{.yaml filename="document.qmd"}
---
title: "My Document"
crossref:
  tbl-title: Sheet
  tbl-prefix: Sh
  tbl-labels: roman
  title-delim: "â€”"   
---
```

![](images/figure-table-caption-format-edit.png)

Same for `fig`: `fig-title`, `fig-prefix`, `fig-labels`

Shared: `title-delim`

`labels`, `subref-labels`,`fig-labels`, `tbl-labels`:`arabic`, `alpha a`, `alpha A`, `roman i`, `roman I` 


```{.yaml filename="document.qmd"}
---
title: "My Document"
crossref:
  fig-title: Fig
  fig-prefix: Fig
  fig-labels: roman
  title-delim: "."   
---
```

## Layout {#sec-advanced-layout}

Use `layout` to control arrangement.

Do some examples without captions, but use fenced divs e.g.

````
::: {layout-ncol="2"}
::: {}
| Column 1 | Column 2 | Column 3 |
|----------|----------|----------|
| Row 1    | Data A   | Value X  |
| Row 2    | Data B   | Value Y  |
| Row 3    | Data C   | Value Z  |
:::

::: {}
| Column 1 | Column 2 | Column 3 |
|----------|----------|----------|
| Row 1    | Data A   | Value X  |
| Row 2    | Data B   | Value Y  |
| Row 3    | Data C   | Value Z  |
:::
:::
````

Then talk about cross-references and captions by filling in the empty `{}` divs with labels, and adding extra caption lines. 

Tricky combo: caption but not cross referenceable. Ignore? Mention. What's the general translation for the examples we do do. 

### Arranging multiple tables and/or figures {#sec-multiple-outputs}

Quarto provides a set of layout code cell options and attributes that allow you to arrange multiple figures or tables in a single panel.
As an example, `layout-ncol` specifies the number of columns in a panel layout.
You can use it as a code cell option:

````{.markdown}
```{{LANGUAGE}}
#| layout-ncol: 2

# CODE TO GENERATE TWO FIGURES/TABLES
```
````

Or you can use it as an attribute in a fenced div:

````{.markdown}
::: {layout-ncol="2"}

```{{LANGUAGE}}
# CODE TO GENERATE A SINGLE FIGURE OR TABLE
```

```{{LANGUAGE}}
# CODE TO GENERATE ANOTHER FIGURE OR TABLE
```
:::

````

Using the code cell option is the simplest approach, 
but as soon as you want some combination of: a mix of figures and tables, 
individual captions, to control placement on the page, or individual cross-references, we recommend using the attribute in a fenced div and nesting your code inside.

In the following sections, learn about `layout-nrow`/`layout-ncol`, and `layout`.

`layout-align`/`layout-valign` 


````{.markdown}
::: {layout-ncol="2"}

```{{LANGUAGE}}
#| label: fig-1
#| fig-cap: "Figure 1 caption"
# CODE TO GENERATE A SINGLE FIGURE OR TABLE
```

```{{LANGUAGE}}
#| label: fig-2
# CODE TO GENERATE ANOTHER FIGURE OR TABLE
```
:::
````

````{.markdown}
::: {#fig-plots}
::::: {layout-ncol="2"}

```{{LANGUAGE}}
# CODE TO GENERATE A SINGLE FIGURE OR TABLE
```

```{{LANGUAGE}}
# CODE TO GENERATE ANOTHER FIGURE OR TABLE
```
:::::

CAPTION
:::
````

Arranging multiple figures or tables in a single panel is a common requirement.
You can do this using the `layout` code cell options, or by using fenced divs with the `layout` classes. 

It's possible to specify a layout of multiple figures or tables produced in a single code cell using the `layout` or `layout-ncol`/`layout-nrow` code cell options.

````{.markdown}
::: {layout-ncol="2"}

```{{LANGUAGE}}
# CODE TO GENERATE A SINGLE FIGURE OR TABLE
```

```{{LANGUAGE}}
# CODE TO GENERATE ANOTHER FIGURE OR TABLE
```
:::

````

However, we recommend using fenced divs instead, because they are more flexible and easier to read.

Combing multiple layout classes in a single fenced div can be unpredictable.
You should instead nest fenced divs to create complex layouts.

### Relative to page

Combining column classes `column` with fenced div

Available columns:
https://quarto.org/docs/authoring/article-layout.html#available-columns

Via code cell option, or fenced div attribute.

## Embedding figures and tables from other documents

## Interactive Components

HTML formats. How are they included? `` ```{=html} `` blocks

## Move somewhere else?

### LaTeX specific things

Move to Documents chapter: `fig-scap`, `fig-env`, `fig-pos`, 

## Treating as non-computational

Save figures in code in as many formats as you need
Include via markdown explicitly leaving off extension so Quarto picks right one for format\