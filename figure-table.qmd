---
echo: false
---

# Figures and tables {#sec-figures-and-tables}
```{r}
#| eval: false
#| include: false

## Occasionally run this re-generate screenshots
source("_examples/figure-table/generate-screenshots.R")
```
```{r}
#| include: false
{{< include _examples/figure-table/_code-snippets/setup.R >}}
```

## Overview

Most common kinds of output from computational cells. 
Also the ones you get some of the biggest gains from literate programming.

Images and markdown tables discussed in @sec-authoring.

Big difference, use code cell options rather than markdown syntax.

First, in basic cell options learn the cell options that you'll use most often and correspond to the markdown syntax you've seen.

Then dive into cross-references, captions and layout. 

We'll focus on things that are common across engines but provide some additional engine and language specific tips and troubleshooting.

::: {.callout-tip}

## Common questions about figures and tables

How do I :

* Cross-reference my figure/table 

* Change the position of the figure/table

* Arrange multiple figures and/or tables in a single panel

* Change the format or location of the caption

* Control the size or aspect ratio of my figure

* Control the styling of my table 

* Troubleshoot the table or figure output from a particular package

::: 

### The examples in this chapter

We wanted authentic examples of figures and tables generated by code in this chapter.
However, the focus of this chapter isn't on the code, and we don't want it to distract you.
To balance those objectives we've selected a small number of examples that we'll repeat throughout the chapter.
These examples are designed to be almost identical between R and Python, 
but this means they are created with a very limited set of packages (ggplot2 and GT in R, and plotnine and great_tables in Python).

We've provided examples in both R and Python so you can reproduce them in your favorite language.
The concepts you are learning are language (and package) agnostic, 
so while the executable code is different,
the code cell options, and markdown syntax are identical.

The code to generate the example figures and tables is shown without any other context.
If you want to recreate them, you'll need the setup code as shown in @fig-setup.
We also show the rendered examples without a code echo, i.e. we set `echo: false` in our document header:

```{.yaml filename="document.qmd"}
---
echo: false
---
```

::: {#fig-setup}

:::{.panel-tabset}

## R

````{.r filename="setup.R"}
{{< include _examples/figure-table/_code-snippets/setup.R >}}
````

## Python

```{.python filename="setup.py"}
{{< include _examples/figure-table/_code-snippets/setup.py >}}
```

:::

Code required before executing the examples in this chapter

:::




## Basic cell options {#sec-figtab-basic}

The chunk options you'll use most often are the analogs of those you would set with markdown when including a non-computational table or figure in a Quarto document.
These options are:

*  `label`: The ID for the resulting figure/table. You must omit the `#`. 
    If the label starts with `fig-` or `tbl-`, the figure or table will be numbered, and can be cross-referenced. 

*  `fig-cap`/`tbl-cap`: The caption for the resulting figure/table. 
    Use standard YAML syntax for long strings (@sec-yaml-long-strings) if you need to break across lines, but ensure each line starts with `#|`. (TODO: Currently not true for `jupyter` engine. Check on state of <https://github.com/quarto-dev/quarto-cli/issues/11290>)

*  `fig-alt`: Alternative text for the resulting figure. There is no `tbl` equivalent, because tables are text-based and generally accessible to screen readers.

@fig-tbl-compare and @fig-fig-compare compare the syntax for non-computational and computational tables and figures using placeholders (in uppercase) for the content.

::: {#fig-tbl-compare}

:::{}
```{.markdown}
MARKDOWN TABLE

: CAPTION {#LABEL}
```

Markdown table

:::

:::{}
````{.markdown}
```{{LANGUAGE}}
#| label: LABEL
#| tbl-cap: CAPTION

# CODE
```
````

Computational table
:::

A comparison of the syntax for a table created with markdown, and a table created in a code cell. TODO: turn this into a diagram so we can color code the same info

::: 

::: {#fig-fig-compare}

:::{}
```{.markdown}
![CAPTION](PATH){#LABEL fig-alt="ALT TEXT"}
```

Markdown figure
:::

:::{}
````{.markdown}
```{{LANGUAGE}}
#| label: LABEL
#| fig-cap: CAPTION
#| fig-alt: ALT TEXT

# CODE
```
````

Computational figure

:::

A comparison of the syntax for a figure created with markdown, and a figure created in a code cell.  TODO: turn this into a diagram so we can color code the same info

::: 

As a concrete example, consider the non-computational table in @lst-markdown-table.

:::{#lst-markdown-table}
```{.markdown .code-overflow-wrap}
| species    | n   |
|------------|-----|
| Adelie     | 152 |
| Chinstrap  | 68  |
| Gentoo     | 124 |

: Number of penguins sampled from each species in the Palmer Archipelago {#tbl-species-count}
```

Markdown to produce a captioned and numbered table
:::

This table could have instead been produced by an executable code cell, as shown in @fig-tables.

::: {#fig-tables}

::: {.panel-tabset group="language"}

## R

````{.markdown}
```{{r}}
#| label: tbl-species-count
#| tbl-cap: "Number of penguins sampled from each species in the Palmer Archipelago"

{{< include _examples/figure-table/_code-snippets/species-count.R >}}
```
````

## Python

````{.markdown}
```{{python}}
#| label: tbl-species-count
#| tbl-cap: "Number of penguins sampled from each species in the Palmer Archipelago"

{{< include _examples/figure-table/_code-snippets/species-count.py >}}
```
````

:::

Basic table chunk options used for a computational table. Compare to @lst-markdown-table

:::

When rendered the result is shown in @fig-basic-cell-options-table.
Notice the caption is prefaced by "Table 1:" --- this is because the label started with `tbl-` which signals to Quarto this is a cross-referenceable table. 
You'll learn more about cross-references in @sec-figtab-crossrefs.

![Example output when @fig-tables is rendered](images/figure-table-basic-cell-options-table.png){#fig-basic-cell-options-table fig-alt=""}


Similarly, @lst-markdown-figure shows a non-computational figure, that could instead be produced using the code cells shown in @fig-figures.

::: {#lst-markdown-figure}

```{.markdown .code-overflow-wrap}
![Penguin bill length versus depth by species](images/width-vs-depth.png){#fig-scatter fig-alt="Scatter plot of bill length vs. depth showing distinct species clustering."}
```

Markdown used to include a non-computational figure.
:::

::: {#fig-figures}

::: {.panel-tabset group="language"}

## R

````{.markdown}
```{{r}}
#| label: fig-scatter
#| fig-cap: "Penguin bill length versus depth by species"
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```
````

## Python

````{.markdown}
```{{python}}
#| label: fig-scatter
#| fig-cap: "Penguin bill length versus depth by species"
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```
````

:::

Basic figure chunk options used for a computational figure. Compare to @lst-markdown-figure.

:::

The result is shown in @fig-basic-cell-options-figure.
The caption here is prefaced by "Figure 1:" because the label started with `fig-`, the signal that this is a cross-referenceable figure. 

![Example output when @fig-figures is rendered](images/figure-table-basic-cell-options-figure.png){#fig-basic-cell-options-figure fig-alt=""}


## Cell option quick reference

The table below summarizes other commonly used code cell options for figures and tables and where in this chapter you can learn more about them.

We only list options common to both the `knitr` and `jupyter` engines.
Use quarto doc reference for full list of available options.


| Option | Description | Reference |
|--------|-------------|-----------|
|`label` | ID for output, also used for cross-references. | @sec-figtab-basic, start with `tbl` or `fig` to number and cross-reference, see @sec-figtab-crossrefs. |
| `fig-cap` | Caption for figure                          | @sec-figtab-basic, can be an array if you produce multiple figures, see @sec-multiple-outputs. |
| `tbl-cap` | Caption for table                           | @sec-figtab-basic, can be an array if you produce multiple tables, see @sec-multiple-outputs. |
| `fig-alt` | Alternative text description of the figure  | @sec-figtab-basic, can be an array if you produce multiple figures, see @sec-multiple-outputs |
| `fig-subcap` | Sub-captions for multiple figures produced in a single code cell | |
| `tbl-subcap` | Sub-captions for multiple tables produced in a single code cell | |
| `cap-location` | Location of caption relative to figure or table | See @sec-caption-location. Also `fig-cap-location` and `tbl-cap-location` 
| `layout-ncol` | Number of columns when arranging multiple figures or tables in a single panel | See @sec-multiple-outputs. Also `layout-nrow`.|
| `layout` | Layout specification when arranging multiple figures or tables in a single panel | See @sec-multiple-outputs. |
| `layout-align` / `layout-valign` | Alignment when arranging multiple figures or tables in a single panel | See @sec-multiple-outputs. |
| `column` | Place figure or table in a specific column relative to page | See @sec-single-page-layouts. Also `fig-column` and `tbl-column`.|
| `tbl-colwidths` | Column widths for markdown tables | See @sec-table-column-widths. |

: Quick Reference for code cell options for figures and tables 

## Cross-references {#sec-figtab-crossrefs}

To cross-reference a computational figure or table you need to:

1. Label your figure or table in a way that Quarto recognizes as a cross-reference, this means using a label that starts with `fig-` or `tbl-`.

2. Refer to your figure or table using the syntax `@LABEL`.

The two examples in @sec-figtab-basic, @fig-tables and @fig-figures,  used the labels `tbl-species-count` and `fig-scatter`. 
To refer to these outputs you could use, for example,:

```{.markdown .code-overflow-wrap}
Most penguins were Adelie (@tbl-species-count). @fig-scatter shows quite distinct clustering of the three species in bill length versus depth.
```


When rendered the cross-references are replaced with the figure or table identifier and become links. 

![](images/figure-table-cross-references-link.png)

See other cross-reference types in @sec-crossreferences

### Fenced div syntax

Alternative to setting `label` and `fig-cap`/`tbl-cap` as code cell options
Set identifier as ID in fenced div
Use code cell to generate table or figure
Caption is last line in div

```{.markdown}
::: {#LABEL}

CONTENT

CAPTION

:::
```

::: {.panel-tabset group="language"}

## R

````{.markdown}
::: {#fig-scatter} 
```{{r}} 
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```

Penguin bill length versus depth by species

:::
````

## Python

````{.markdown}
::: {#fig-scatter}
```{{python}}
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```

Penguin bill length versus depth by species

:::
````

:::


When to use: long captions, dynamic captions.

#### Long captions

If your caption is getting long and it is increasingly painful to track as a code cell option, consider using the div syntax instead.
You can then split lines in a way that makes sense and not have to worry about the YAML syntax.

::: {#fig-long-captions}

::: {.panel-tabset group="language"}

## R
 
````{.markdown}
::: {#fig-scatter}

```{{r}}
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```

Scatter plot depicting the relationship between bill length (mm) and bill depth (mm) across different penguin species. 
The clustering of the species reveals morphological differences in bill dimensions: 
**Adelie** penguins have short, deep bills,
whereas **Gentoo** penguins have long, shallow bills.
**Chinstrap** penguins have similar depth bills to Adelie penguins but there bills are longer.

:::
````
 
## Python
 
````{.markdown}
::: {#fig-scatter}

```{{python}}
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```

Scatter plot depicting the relationship between bill length (mm) and bill depth (mm) across different penguin species. 
The clustering of the species reveals morphological differences in bill dimensions: 
**Adelie** penguins have short, deep bills,
whereas **Gentoo** penguins have long, shallow bills.
**Chinstrap** penguins have similar depth bills to Adelie penguins but there bills are longer.

::: 
````
 
:::

:::

:::{.callout-important}

## No multi-paragraph captions

Quarto doesn't support captions that consist of multiple paragraphs.

:::

#### Dynamic captions

::: {#fig-dynamic-captions}

::: {.panel-tabset group="language"}

## R
 
````{.markdown}
::: {#fig-scatter}

```{{r}}
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```

Penguin bill length versus depth by species for `{{r}} nrow(penguins)` penguins.

:::
````
 
## Python
 
````{.markdown}
::: {#fig-scatter}

```{{python}}
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```

Penguin bill length versus depth by species `{{python}} penguins.height` penguins.

::: 
````
 
:::

:::

### Multiple figures or tables

Refer to other sections...

Use array for `fig-subcap` / `tbl-subcap`
Can reference with `@fig-label-1`.

Use `layout` to control arrangement.
Also see mixed examples in Layout section.

## Captions

### Caption text

Refer to previous sections:

* Use code cell options or last element in fenced divs to set content of captions.
* Include dynamic content in captions by using div syntax and inline code.

### Sub-captions

When your code chunk produces two or more figures, or two or more tables,
using `fig-subcap` or `tbl-subcap` is a quick way to generate a multi-panel figure or table.


::: {.panel-tabset group="language"}

## R
 
````{.markdown}
```{{r}}
#| label: tbl-species-count
#| tbl-cap: "Penguins sampled from the Palmer Archipelago"
#| tbl-subcap: 
#|   - "Breakdown by species"
#|   - "Breakdown by species and year"

{{< include _examples/figure-table/_code-snippets/species-count.R >}}

{{< include _examples/figure-table/_code-snippets/species-year.R >}}
```
 
````
 
## Python
 
````{.markdown}
```{{python}}
#| label: tbl-species-count
#| tbl-cap: "Penguins sampled from the Palmer Archipelago"
#| tbl-subcap: 
#|   - "Breakdown by species"
#|   - "Breakdown by species and year"

{{< include _examples/figure-table/_code-snippets/species-count.py >}}

{{< include _examples/figure-table/_code-snippets/species-year.py >}}
```
 
````
 
:::


![](images/figure-table-captions-subcaptions.png)

Must be cross-reference
Can't mix figure and tables.

Can refer to panels by adding suffix to reference.

```{.markdown}
See @tbl-species-count, @tbl-species-count-1, @tbl-species-count-2
```

![](images/figure-table-captions-subcaptions-reference.png)

More flexibly, use fenced divs to create sub-captions. See ...

### Caption location {#sec-caption-location}

By default, Quarto puts figure captions at the bottom of the figure, and table captions at the top of the table.
You can control this with the `cap-location` option for both figures and tables, or separately with the `fig-cap-location` and `tbl-cap-location` options.
Can take the values `top`, `bottom`, or `margin` (`margin` only in some formats).

::: {.panel-tabset group="language"}

## R
 
````{.markdown filename="document.qmd"}
```{{r}}
#| label: tbl-species-count
#| tbl-cap: "Penguins sampled from the Palmer Archipelago"
#| cap-location: bottom

{{< include _examples/figure-table/_code-snippets/species-count.R >}}
``` 
````
 
## Python
 
````{.markdown filename="document.qmd"}
```{{python}}
#| label: tbl-species-count
#| tbl-cap: "Penguins sampled from the Palmer Archipelago"
#| cap-location: bottom

{{< include _examples/figure-table/_code-snippets/species-count.py >}}
``` 
````
 
:::

For example,

::: {#fig-cap-location}

:::{layout="[[1,1], [1]]"}
:::{}
![](images/figure-table-captions-location-top.png){.border}

`top`
:::
:::{}
![](images/figure-table-captions-location-bottom.png){.border}

`bottom`
:::

:::{}
![](images/figure-table-captions-location-margin.png){.border}

`margin`
:::
:::

Tables with the code cell option `cap-location` set to: `top`, `bottom` and `margin`.

:::


::: {#fig-cap-location-document}

:::{layout-ncol="2"}
```{.yaml filename="document.qmd"}
---
title: "My Document"
cap-location: bottom
---
```

```{.yaml filename="_quarto.yml"}
cap-location: bottom
```
:::

You can set the caption location for the entire document in the document header, or for all documents in a project using `_quarto.yml`.

:::

### Caption titles and numbering

Document level (or project level options)!

:::{#fig-cap-title}

::: {layout="[2, 1]"}
:::{}
![](images/figure-table-caption-format.jpeg){.border width="50%"}

Table Caption
:::

:::{}
![](images/figure-table-cross-reference-form.jpeg){.border width="50%"}

Inline reference
:::

:::
:::

```{.yaml filename="document.qmd"}
---
title: "My Document"
crossref:
  tbl-title: Sheet
  tbl-prefix: Sh
  tbl-labels: roman
  title-delim: "â€”"   
---
```

![](images/figure-table-caption-format-edit.png)

Same for `fig`: `fig-title`, `fig-prefix`, `fig-labels`

Shared: `title-delim`

`labels`, `subref-labels`,`fig-labels`, `tbl-labels`:`arabic`, `alpha a`, `alpha A`, `roman i`, `roman I` 


```{.yaml filename="document.qmd"}
---
title: "My Document"
crossref:
  fig-title: Fig
  fig-prefix: Fig
  fig-labels: roman
  title-delim: "."   
---
```

## Layout


### Figure Alignment {#sec-fig-align}

The `fig-align` code cell option controls the horizontal alignment of figures relative to surrounding content, 
and can take values of `default` (the default for the target format), `left`, `right`, or `center`. 

For example to left-align:

::: {.panel-tabset group="language"}

## R
 
````{.markdown}
```{{r}}
#| fig-align: left

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```
````
 
## Python
 
````{.markdown}
```{{r}}
#| fig-align: left

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```
````

:::


![TODO: An image here with the alignment options. Make it clear this is relative to text above and below plot](){}

### Arranging multiple tables and/or figures {#sec-multiple-outputs}

Examples of arraning multuple figures, using array for `fig-cap` `fig-alt` and various `layout` options.


Quarto provides a set of layout code cell options and attributes that allow you to arrange multiple figures or tables in a single panel.
As an example, `layout-ncol` specifies the number of columns in a panel layout.
You can use it as a code cell option:

````{.markdown}
```{{LANGUAGE}}
#| layout-ncol: 2

# CODE TO GENERATE TWO FIGURES/TABLES
```
````

Or you can use it as an attribute in a fenced div:

````{.markdown}
::: {layout-ncol="2"}

```{{LANGUAGE}}
# CODE TO GENERATE A SINGLE FIGURE OR TABLE
```

```{{LANGUAGE}}
# CODE TO GENERATE ANOTHER FIGURE OR TABLE
```
:::

````

Using the code cell option is the simplest approach, 
but as soon as you want some combination of: a mix of figures and tables, 
individual captions, to control placement on the page, or individual cross-references, we recommend using the attribute in a fenced div and nesting your code inside.


`layout-nrow`/`layout-ncol` 





`layout` 


`layout-align`/`layout-valign` 




````{.markdown}
::: {layout-ncol="2"}

```{{LANGUAGE}}
#| label: fig-1
#| fig-cap: "Figure 1 caption"
# CODE TO GENERATE A SINGLE FIGURE OR TABLE
```

```{{LANGUAGE}}
#| label: fig-2
# CODE TO GENERATE ANOTHER FIGURE OR TABLE
```
:::
````

````{.markdown}
::: {#fig-plots}
::::: {layout-ncol="2"}

```{{LANGUAGE}}
# CODE TO GENERATE A SINGLE FIGURE OR TABLE
```

```{{LANGUAGE}}
# CODE TO GENERATE ANOTHER FIGURE OR TABLE
```
:::::

CAPTION
:::
````

You might use the code cell option when your code produces:

* all figures, or all tables, but not a mix of both, or

* many figures or tables (i.e. in a loop) that don't need captions or individual cross-references

* 
 or in simple cases where you don't also need have 


 is easiest when your  is the simplest approach, but it can be less flexible than using fenced divs.

, or as an attribute in a fenced div.

is both a code cell option, and an attribute, that specifies the number of columns in a layout.


````{.markdown}
````

Arranging multiple figures or tables in a single panel is a common requirement.
You can do this using the `layout` code cell options, or by using fenced divs with the `layout` classes. 

It's possible to specify a layout of multiple figures or tables produced in a single code cell using the `layout` or `layout-ncol`/`layout-nrow` code cell options.



````{.markdown}
::: {layout-ncol="2"}

```{{LANGUAGE}}
# CODE TO GENERATE A SINGLE FIGURE OR TABLE
```

```{{LANGUAGE}}
# CODE TO GENERATE ANOTHER FIGURE OR TABLE
```
:::

````



::: {.panel-tabset group="language"}

## R
 
````{.markdown}
```{{r}}
#| layout-ncol: 2

{{< include _examples/figure-table/_code-snippets/species-count.R >}}

{{< include _examples/figure-table/_code-snippets/species-year.R >}}
```
 
````
 
## Python
 
````{.markdown}
```{{python}}
#| layout-ncol: 2

{{< include _examples/figure-table/_code-snippets/species-count.py >}}

{{< include _examples/figure-table/_code-snippets/species-year.py >}}
```
 
````
 
:::

::: {.panel-tabset group="language"}

## R
 
````{.markdown}
::: {layout-ncol="2"}

```{{r}}
{{< include _examples/figure-table/_code-snippets/species-count.R >}}
```

```{{r}}
{{< include _examples/figure-table/_code-snippets/species-year.R >}}
```
:::
````
 
## Python
 
````{.markdown}
::: {layout-ncol="2"}

```{{python}}
{{< include _examples/figure-table/_code-snippets/species-count.py >}}
```

```{{python}}
{{< include _examples/figure-table/_code-snippets/species-year.py >}}
```
:::
````

:::


However, we recommend using fenced divs instead, because they are more flexible and easier to read.

Combing multiple layout classes in a single fenced div can be unpredictable.
You should instead nest fenced divs to create complex layouts.




Arrays for `fig-cap`, `fig-alt`, `label`?


`layout-nrow` `layout-ncol` `layout`
`layout-align` `layout-valign`


`tbl-subcap`, `fig-subcap`, can `fig-alt` be an array?

Using fenced divs instead. E.g. figure next to image. Table next to figure.

Putting multiple figures/tables in a panel: Using chunk options: i.e. all plots, tables computed in single code chunk 

### Relative to page

Placing figures/tables on page: column classes `column`, `fig-column`, `tbl-column`, latex fig pos, `fig-pos`

Available columns:
https://quarto.org/docs/authoring/article-layout.html#available-columns

Via code cell option, or fenced div attribute.

### Relative to slide

`output-location`

### Table column widths

`tbl-colwidths` document or code cell option to set width for columns in markdown tables. 


## Figure Sizing

### Set default at document level

Document level options to set default figure size for document/project.

### Set in your code 

Knitr only: cell level option

## Figure formats

Document level options to set default figure format for document/project.

### Set default at document level

Document level options to set default figure format.
Could be format specific, e.g. `PNG` for HTML, `SVG` for PDF?

### Set in your code 

Knitr only: cell level option

## Embedding figures and tables from other documents


## Troubleshooting

`keep-md` to check what is being generated

### Getting plots to show up in `jupyter` engine

### How to get tables into Quarto? HTML vs. markdown

### Interactive Components

## Move somewhere else?

### LaTeX specific things

Move to Documents chapter: `fig-scap`, `fig-env`, `fig-pos`, 

### Format specific layout

RevealJS: `output-location`

HTML: `panel`

Dashboards: computational figures/tables becomes cards laid out in rows and columns
