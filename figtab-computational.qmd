# Computational figures and tables {#sec-computational-figures-tables}

```{r}
#| eval: false
#| label: screenshots
#| include: false

## Occasionally run this re-generate screenshots
source("_examples/figure-table/generate-screenshots.R")
```
```{r}
#| eval: false
#| label: code-setup
#| include: false
{{< include _examples/figure-table/_code-snippets/setup.R >}}
```

## Overview

This chapter covers topics specific to figures and tables that are the output of executable code cells.
Producing figures and tables with code has many advantages:

- Your figures and tables are always up to date.
- You can change labelling, styling, colors etc. right in document source.
- Quarto handles file formats and paths, so you don't have to.

You'll start by reviewing the most common code cell options for figures and tables---those that add captions, identifiers and alternative text.

Then, we split the rest of the chapter into two sections: one for figures (covering size, format, resolution, and creating multiple figures) and one for tables (covering table formats, and creating multiple tables).

Much of the control of computational figures and tables comes from code cell options.
To help you navigate this, and other chapters, we list the most common code cell options in @tbl-figtab-ref.
With one exception, we only list options common to both the `knitr` and `jupyter` engines.
Use the [Quarto Code Cell Reference](https://quarto.org/docs/reference/cells/) for the full list of available options.


| Option | Document Option | Description | Reference |
|:-------|-----------------|:------------|:----------|
|`label` | | ID for output, also used for cross-references. | @sec-figtab-basic, preface with `tbl-` or `fig-` to number and cross-reference, see @sec-figtab-crossref. |
| `fig-cap` | | Caption for figure                          | @sec-figtab-basic. For control over appearance see @sec-figtab-captions. |
| `tbl-cap` | | Caption for table                           | @sec-figtab-basic. For control over appearance see @sec-figtab-captions. |
| `fig-alt` | | Alternative text description of the figure  | @sec-figtab-basic |
| `fig-subcap` | | Sub-captions for multiple figures produced in a single code cell | @sec-multiple-figures |
| `tbl-subcap` | | Sub-captions for multiple tables produced in a single code cell |@sec-multiple-tables  |
| `layout-ncol`/ `layout-nrow` | | Number of columns when arranging multiple figures or tables in a single panel | For figures see @sec-multiple-figures, for tables see @sec-multiple-tables. For more complicated layouts see @sec-panel-layout. |
| `column` / `fig-column` / `tbl-column` | | Place figure or table in a specific column relative to page | @sec-page-columns |
| `output-location` | | Place figure or table in a specific location relative to slide | @sec-output-location. |
| `fig-width` / `fig-height` **knitr engine only** | ☑ | Size of figure in inches | @sec-figure-size, also includes options for `jupyter` engine |
| `fig-align`| ☑ | Alignment of figures in their surrounding container | @sec-figure-alignment |
| `tbl-colwidths` | ☑ | Column widths for markdown tables | @sec-table-column-widths |
| `layout` | | Layout specification when arranging multiple figures or tables in a single panel | @sec-panel-layout |
| `layout-align` / `layout-valign` | | Alignment when arranging multiple figures or tables in a single panel | @sec-panel-layout |
| `cap-location` / `fig-cap-location` /  `tbl-cap-location` | ☑ | Location of caption relative to figure or table | @sec-caption-location |

: Commmon code cell options for figures and tables {#tbl-figtab-ref tbl-colwidths="[25,5,40,30]"}

### The examples in this chapter

We wanted authentic examples of figures and tables generated by code in this chapter.
However, the focus of this chapter isn't on the code, and we don't want it to distract you.
To balance those objectives we've selected a small number of examples that we'll repeat throughout the chapter.
These examples are designed to be almost identical between R and Python, 
but this means they are created with a very limited set of packages (ggplot2 and GT in R, and plotnine and great_tables in Python).

We've provided examples in both R and Python so you can reproduce them in your favorite language.
The concepts you are learning are language (and package) agnostic, 
so while the executable code is different,
the code cell options, and markdown syntax are identical.

The code to generate the example figures and tables is shown without any other context.
If you want to recreate them, you'll need the setup code as shown in @fig-setup.
We also show the rendered examples without a code echo, i.e. we set `echo: false` in our document header:

```{.yaml filename="document.qmd"}
---
echo: false
---
```

::: {#fig-setup}

:::{.panel-tabset}

## R

````{.r filename="setup.R"}
{{< include _examples/figure-table/_code-snippets/setup.R >}}
````

## Python

```{.python filename="setup.py"}
{{< include _examples/figure-table/_code-snippets/setup.py >}}
```

:::

Code required before executing the examples in this chapter

:::


## Basics {#sec-figtab-basic}

If the output of an executable code cell is a figure or a table, Quarto will automatically include it in the rendered document.
For example, in @fig-figure-quick the code cell produces a figure.

::: {#fig-figure-quick}

::: {.panel-tabset group="language"}

## R

````{.markdown}
Some text before the code cell.

```{{r}}
{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```

Some text after the code cell.
````

## Python

````{.markdown}
Some text before the code cell.

```{{python}}
{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```

Some text after the code cell.
````

:::

A document with an executable code cell that produces a figure

:::

When the document is rendered that figure appears right where the code cell was (@fig-quick-start-figure).

![A rendered document with a figure produced by a code cell](images/figure-table-quick-start-figure.png){#fig-quick-start-figure .border fig-alt="Screenshot of Quarto HTML document with a scatterplot shown below the line of text 'Some text before the code cell' and above the line of text 'Some text after the code cell'."}

For non-computational figures and tables, additional context, like a caption or identifier, is added via markdown syntax.
For computational figures and tables, additional context is added via code cell options.

The most common options are:

*  `label`: The ID for the resulting figure/table. You must omit the `#`. 
    If the label starts with `fig-` or `tbl-`, the figure or table will be numbered, and can be cross-referenced. 

*  `fig-cap`/`tbl-cap`: The caption for the resulting figure/table. 
    Use standard YAML syntax for long strings (@sec-yaml-long-strings) if you need to break across lines, but ensure each line starts with `#|`. (TODO: Currently not true for `jupyter` engine. Check on state of <https://github.com/quarto-dev/quarto-cli/issues/11290>)

*  `fig-alt`: Alternative text for the resulting figure. There is no `tbl` equivalent, because tables are text-based and generally accessible to screen readers.

For example, @fig-figures uses the same code as @fig-figure-quick but adds an identifier, caption, and alternative text with code cell options.

::: {#fig-figures}

::: {.panel-tabset group="language"}

## R

````{.markdown}
```{{r}}
#| label: fig-scatter
#| fig-cap: "Penguin bill length versus depth by species"
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```
````

## Python

````{.markdown}
```{{python}}
#| label: fig-scatter
#| fig-cap: "Penguin bill length versus depth by species"
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```
````

:::

Basic code cell options used to add an identifier (`label`), caption (`fig-cap`) and alternative text (`fig-alt`) to a computational figure.

:::

The rendered result is shown in @fig-basic-cell-options-figure.
The caption here is prefaced by "Figure 1:" because the label started with `fig-`, the signal that this is a cross-referenceable figure. 

![Example output when @fig-figures is rendered](images/figure-table-basic-cell-options-figure.png){#fig-basic-cell-options-figure fig-alt=""}

@fig-tables demonstrates the same concept for tables.
To caption a table use the `tbl-cap` option, 
and start the label with `tbl-` to make it cross-referenceable.


::: {#fig-tables}

::: {.panel-tabset group="language"}

## R

````{.markdown}
```{{r}}
#| label: tbl-species-count
#| tbl-cap: "Number of penguins sampled from each species in the Palmer Archipelago"

{{< include _examples/figure-table/_code-snippets/species-count.R >}}
```
````

## Python

````{.markdown}
```{{python}}
#| label: tbl-species-count
#| tbl-cap: "Number of penguins sampled from each species in the Palmer Archipelago"

{{< include _examples/figure-table/_code-snippets/species-count.py >}}
```
````

:::

Basic code cell options used to add an identifier (`label`) and caption (`tbl-cap`) for a computational table.

:::

The result is shown in @fig-basic-cell-options-table.
The table caption is prefaced by "Table 1:" because `label` started with `tbl-`, the signal that this is a cross-referenceable table.

![Example output when @fig-tables is rendered](images/figure-table-basic-cell-options-table.png){#fig-basic-cell-options-table fig-alt="Rendered table with caption above it 'Table 1: Number of penguins sampled from each species in the Palmer Archipelago'."}

### Fenced div syntax

For cross-referenceable figures and tables, fenced divs provide an alternative method for labeling and captioning. 
Instead of using the code cell options `label` and `fig-cap`/`tbl-cap`, you set the identifier on a fenced div, and the caption as the last line inside the fenced div.
The contents above the last line becomes the content of the figure or table, and could be a code cell.

As a concrete example, @fig-fenced-div-figure gives the labelled and captioned figure as the code cell in @fig-figures.
@fig-fenced-div-table does the same for the table in @fig-tables.

::: {#fig-fenced-div-figure}
::: {.panel-tabset group="language"}

## R

````{.markdown}
::: {#fig-scatter} 
```{{r}} 
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}
```

Penguin bill length versus depth by species

:::
````

## Python

````{.markdown}
::: {#fig-scatter}
```{{python}}
#| fig-alt: "Scatter plot of bill length vs. depth showing distinct species clustering."

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}
```

Penguin bill length versus depth by species

:::
````

:::

The equivalent fenced div syntax for @fig-figures.

:::


:::{#fig-fenced-div-table}

::: {.panel-tabset group="language"}

## R

````{.markdown}
::: {#tbl-species-count}

```{{r}}
{{< include _examples/figure-table/_code-snippets/species-count.R >}}
```

Number of penguins sampled from each species in the Palmer Archipelago
:::
````

## Python

````{.markdown}
::: {#tbl-species-count}

```{{python}}
{{< include _examples/figure-table/_code-snippets/species-count.py >}}
```

Number of penguins sampled from each species in the Palmer Archipelago
:::
````

:::

The equivalent fenced div syntax for @fig-tables.

:::

The fenced div syntax is useful if you want long captions (@sec-long-captions), dynamic captions that depend on code output (@sec-dynamic-captions), or to combine multiple figures and tables into a single panel with a shared caption (@sec-panel-layout).

## Figures {#sec-figtab-figures}

In this section you'll learn about figure-specific options: **figure size**, **format and resolution**, and **alignment**. Some of these controls are *document options* (set in your document header and applied to all figures), some are *code cell options* (applied to individual code cells), and others need to be configured directly in your plotting code. We'll use *emphasis* to highlight when an option is a document-level setting versus a code cell option. 

### Default figure size

The *document options* `fig-width` and `fig-height` control the default size of figures produced by all the code cells in a document. 

How these values are applied depends on the engine:

* `knitr`: the values are passed along to the graphics device, and thus apply regardless of the package you use to create the plots.
* `jupyter`: the values are used to set the default figure size for matplotlib. 
    Many popular plotting packages, including seaborn, depend on matplotlib, and will respect these defaults.
    Other packages may not respect matplotlib defaults, like plotnine, but have themselves implemented something to use and respect the  environment variables Quarto sets `QUARTO_FIG_WIDTH` and `QUARTO_FIG_HEIGHT`.

The default values are format specific.
For example, the default figure size for `format: html` is 7x5 inches, 
which is different to that for `format: pdf` at 5.5x3.5 in.

You can override these defaults using `fig-width` and `fig-height` *document options*.
For example, @lst-fig-width-height shows how to set the default figure size to 4x6 in for `html` output.

::: {#lst-fig-width-height}

```{.yaml filename="document.qmd"}
---
format:
  html:    
    fig-width: 4
    fig-height: 6
---
```

Use the `fig-width` and `fig-height` document options to set the default figure size for a target output format.

:::

Set `fig-width` and `fig-height` at the top-level (i.e. not nested under a format) to apply to all formats.
You could also set `fig-width` and `fig-height` in `_quarto.yml` to apply to all documents in a project.

### Custom figure size {#sec-figure-size}

The defaults set by the document options will apply to all code cells. 
However, you often want to customize figure sizes, and aspect ratios, for individual plots.
How you do this depends on the engine. 

#### `knitr`

In `knitr` use the *code cell options* `fig-width`, `fig-height`

::: {#lst-figure-size}
````{.markdown}
```{{r}}
#| fig-width: 4
#| fig-height: 6

{{< include _examples/figure-table/_code-snippets/island-bar.R >}}
```
````

When using the `knitr` engine, use the code cell options `fig-width` and `fig-height` to customize figure size for individual plots.

:::


#### `jupyter` 

There are no `fig-width` or `fig-height` code cell options for the `jupyter` engine.
You need to set the figure size in the code itself.
This will depend on the plotting package you are using.

For plotting packages that use matplotlib and respect its defaults, you can set figure sizes using matplotlib directly.

For example, @lst-seaborn-figure shows code to create a scatterplot of the `penguins` data using [seaborn](https://seaborn.pydata.org). 
With no further adjustment the size of the figure will reflect the default `fig-height` and `fig-width` document options.

::: {#lst-seaborn-figure}
````markdown
```{{python}}
import seaborn as sns
penguins = sns.load_dataset("penguins")
sns.scatterplot(data=penguins, x="bill_length_mm", y="bill_depth_mm", hue="species")
```
````

Code to create seaborn plot of its own `penguins` data. 

:::

To change the size of the figure you change the matplotlib default plot size using `rcParams`. 
This mimics the way the `jupyter` engine sets the default plot sizes and will apply to all plots created in subsequent code cells. 

::: {#lst-seaborn-figure-rcparams}
````markdown
```{{python}}
import matplotlib as mpl
mpl.rcParams['figure.figsize'] = (8, 4)

sns.scatterplot(data=penguins, x="bill_length_mm", y="bill_depth_mm", hue="species")
```
````    

Use matlplotlibs `rcParams` to change default figure size for all subsequent plots.

:::

Alternatively, to apply a new default for a single plot, use `rc_context` as shown in @lst-seaborn-figure-rccontext.

::: {#lst-seaborn-figure-rccontext}

````markdown
```{{python}}
import matplotlib as mpl
with mpl.rc_context({'figure.figsize': (8, 4)}):
    sns.scatterplot(data=penguins, x="bill_length_mm", y="bill_depth_mm", hue="species")
```
````

Use `rc_context` to create a plot with a temporary change to the matplotlib default figure size.

:::

For packages that don't use matplotlib, or don't respect its defaults, you'll need to refer to their documentation for changing plot size.
For example, in plotnine you can resize a plot through the `theme()` function as shown in @lst-plotnine-figure-size.

::: {#lst-plotnine-figure-size}

````markdown
```{{python}}
(
    ggplot(penguins, aes(x="bill_length_mm", y="bill_depth_mm"))
    + geom_point(aes(color="species"))
    + scale_color_manual(values=penguin_colors)
    + labs(x="Bill Length (mm)", y="Bill Depth (mm)")
    + theme(figure_size=(8, 4))
)
```
````
:::

### Figure format and resolution

The default image format saved by the engines differs by target format.
For example, for `format: html`, images will be PNG (`.png`) by default, for `format: pdf`, images will be PDF (`.pdf`) by default.

You can override these defaults using `fig-format` *document option*.
For example, @lst-fig-format shows how to set the default figure format to `svg` for `html` output.

::: {#lst-fig-format}

````{.yaml filename="document.qmd"}
---
format:
  html:
    fig-format: svg
---
````

Use the `fig-format` document option to set the default figure format for a target output format.

:::

Setting `fig-format` at the top-level will apply to all output formats.
You can also set `fig-format`, at the top-level, or nested under a `format` in `_quarto.yml` to apply it to all documents in a project.

For raster image formats like `png` and `jpg`, you can also control the resolution of the saved image using the `fig-dpi` document option.

For example, @lst-fig-dpi shows how to set the default figure resolution to 300 dots-per-inch for `html` output.

::: {#lst-fig-dpi}

````{.yaml filename="document.qmd"}
---
format:
  html:
    fig-dpi: 300
---
````
Use the `fig-dpi` document option to set the default figure resolution for a target output format.
Like `fig-format` you can set this for all formats, or for all documents in a project via `_quarto.yml`.

:::

### Multiple figures {#sec-multiple-figures}

If your code cell produces multiple figures, you combine them into a single panel by providing individual sub-captions for each figure using the `fig-subcap` code cell option.
For example, @fig-multiple-figures, produces two figures in a single code cell, and thus provides an array of two values to both `fig-subcap` and `fig-alt`.

::: {#fig-multiple-figures}

:::{.panel-tabset group="language"}

## R
 
````{.markdown}
```{{r}}
#| label: fig-scatter
#| fig-cap: Physical dimensions of penguins
#| fig-alt: 
#|   - "Scatter plot of bill length vs. depth showing distinct species clustering."
#|   - "Scatter plot of flipper length vs. body mass showing a strong positive relationship."
#| fig-subcap: 
#|   - "Penguin bill length versus depth by species"
#|   - "Penguin flipper length versus body mass by species"

{{< include _examples/figure-table/_code-snippets/bill-scatter.R >}}

{{< include _examples/figure-table/_code-snippets/size-scatter.R >}}
````
 
## Python
 
````{.markdown}
```{{python}}
#| label: fig-scatter
#| fig-cap: Physical dimensions of penguins
#| fig-alt: 
#|   - "Scatter plot of bill length vs. depth showing distinct species clustering."
#|   - "Scatter plot of flipper length vs. body mass showing a strong positive relationship."
#| fig-subcap: 
#|   - "Penguin bill length versus depth by species"
#|   - "Penguin flipper length versus body mass by species"

{{< include _examples/figure-table/_code-snippets/bill-scatter.py >}}

{{< include _examples/figure-table/_code-snippets/size-scatter.py >}}
````
 
:::

An example of a code cell that produces two figures. Individual figure captions are provided as an array to  `fig-subcap`, and alternative text descriptions are provided as an array to `fig-alt`.

:::

![Result of rendering,  @fig-multiple-figures, a code cell with multiple figures.](images/figure-table-multiple-figures.png){#fig-multiple-figures-rendered fig-alt="Two scatterplots one above the other. Each plot has a caption prefaced by '(a)' and '(b)' respectively. The overall caption is 'Figure 1: Physical dimensions of penguins'."}

When rendered, the figures are placed together in a single "Figure" where the overall caption is provided by `fig-cap` and prefaced by "Figure 1:".
Each individual figure in the panel has its own sub-caption prefaced by "(a)" and "(b)".
You can cross reference the entire panel with the `label`, e.g. `@fig-scatter`, or individual figures by appending an index, e.g.  `@fig-scatter-1` and `@fig-scatter-2`.

Often the use of `fig-subcap` is combined with layout options to arrange the figures in a specific way.
For example, the `layout-ncol` code cell option will arrange the figures in a specified number of columns. 
Adding the code cell option `layout-ncol: 2` to the above example would result in the figures laid out side-by-side rather than one above the other.

Using `fig-subcap` is a quick way to create multi-panel figures, but as soon as you want some combination of: individual captions, a mix of figures and tables, to control placement on the page, or individual cross-references, we recommend using a single code cell for each output, and using the fenced divs syntax to label, caption and arrange them. 
You can learn more about this approach in @sec-figtab-layout.


## Tables  {#sec-figtab-tables}

In this section you'll learn about table-specific options, in particular choosing a  **table format** and controlling things like column alignment and width

### Table format

When you produce a computational table, the engine is writing the resulting table in some plain text format.
The most common formats are markdown pipe tables and HTML tables.
Both markdown pipe tables and HTML tables are supported across all of Quarto's output formats, the choice between them often comes down to how much control you want over the appearance of the table.

Choose:

* **Markdown**: for simple tables that don't require any row, cell or column specific formatting. 

* **HTML**: for more complex tables that require row, cell or column specific styling. While HTML allows for more control over the appearance of the table, not all customization will propagate through to all target formats. The best support for HTML styling is in HTML based formats (`html`, `dashboards` and `revealjs`), and `typst`.

Your package and function choices, along with your target format, determine which format is produced.
Often the format is explicit in your code, e.g. by a call to `Markdown()` in Python.
If it isn't, and you aren't sure which format you have produced, check the intermediate markdown that Quarto produces after executing your code cells.

#### Markdown 

Using the markdown pipe syntax mimics how you might write a table out by hand in Quarto (@sec-markdown-tables). 
There are many ways to produce a markdown table computationally, but we highlight the most general approach for each language here.

##### R

The `kable()` function from the [knitr](https://yihui.org/knitr/) package produces markdown tables by default.
Simply pass your table object to `kable()` and it will return the markdown table:

````markdown
```{{r}}
{{< include _examples/figure-table/_code-snippets/species-count-markdown.R >}}
```
````

The intermediate markdown produced is:

````markdown
|species   |   n|
|:---------|---:|
|Adelie    | 151|
|Chinstrap |  68|
|Gentoo    | 123|
````

Control the alignment of columns (i.e. the position of the colons, `:`) with the `align` argument to `kable()`.


##### Python

The `tabulate()` function from the [tabulate](https://github.com/astanin/python-tabulate) packages can produce markdown tables from a variety of Python data structure. 

A general approach to create markdown tables is:

1. Convert the table to a data type tabulate supports (e.g. a `pandas.DataFrame`)

2. Pass the table to `tabulate()` with `tablefmt='pipe'`

3. Return the result surrounded by `Markdown()` from `IPython.display`

For example, to apply this strategy to a summary table created by Polars:

````markdown
```{{python}}
{{< include _examples/figure-table/_code-snippets/species-count-markdown.py >}}
```
````

When executed, this intermediate markdown is produced:

````markdown
| species   |   len |
|:----------|------:|
| Gentoo    |   123 |
| Adelie    |   151 |
| Chinstrap |    68 |
````

Control the alignment of columns (i.e. the position of the colons, `:`)  with the `colalign` argument to `tabulate()`.

While `tabulate()` is useful general approach you may find simpler ways for your specific situation.
For example, you can set the default print style for polars DataFrames to markdown pipe tables using [`polars.Config.set_tbl_formatting`](https://docs.pola.rs/api/python/stable/reference/api/polars.Config.set_tbl_formatting.html).

#### HTML

The tables in @fig-tables were produced using the GT package in R and great_tables package in Python.
Both packages produce HTML tables by default (they can also produce LaTeX tables see @sec-tables-other-formats).

For example, Figure @lst-intermediate-markdown-table shows a simplified excerpt from the intermediate markdown for the computational table produced in @fig-tables when `format: html`.

:::{#lst-intermediate-markdown-table}
::: {.panel-tabset group="language"}

## R
 
````{.markdown filename="document.html.md"}
::: {.cell-output-display}

```{=html}
<div id="czabgtycdf" ...>
<style>...</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>...</thead>
  <tbody class="gt_table_body">...</tbody>
</table>
</div>
```

:::
:::
````
 
## Python
 
````{.markdown filename="document.html.md"}
::: {.cell-output .cell-output-display execution_count=8}
```{=html}
<div id="jnzyjbmsji" ...>
<style>...</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>...</thead>
  <tbody class="gt_table_body">...</tbody>
</table>
</div>
```
::: 
````
 
:::

Intermediate markdown from the code cells in @fig-tables. The `...` indicate parts omitted for brevity.

:::

Inside the `::: {.cell-output-display}` div, you'll notice the raw HTML block syntax `` ```{=html} ``, and the table is created with the HTML tags `<table>`, `<thead>` and `<tbody>`.
In other words, the code cell has produced an HTML table.

When producing HTML tables, you'll often find the package you are using provides its own styling (i.e. inside `<style>` tags), and ways to customize styling via their own functions.
Read the documentation for your chosen package to see how to customize the appearance of your tables.

#### Other formats {#sec-tables-other-formats}

The computational engine is aware of your target format.
This means packages can produce tables in formats other than markdown or HTML when appropriate.
For example, both the GT (R) and great_tables (Python) packages will produce tables using LaTeX syntax when the target is `pdf`.
Other packages may produce RTF tables when the target format is `docx`.
Refer to the documentation for your chosen package to see what formats are supported.

### Multiple tables {#sec-multiple-tables}

If your code cell produces more than one table,
you can give the tables sub-captions by providing an array to `tbl-subcap`.

For example, @fig-multiple-tables shows a code cell that produces two tables, with sub-captions provided via `tbl-subcap`.
The rendered output is shown in @fig-multiple-tables-rendered. 

::: {#fig-multiple-tables}

::: {.panel-tabset group="language"}

## R
 
````{.markdown}
```{{python}}
#| label: tbl-species-count
#| tbl-cap: "Number of penguins sampled from each species in the Palmer Archipelago"
#| tbl-subcap: 
#|   - "Total"
#|   - "By year"

{{< include _examples/figure-table/_code-snippets/species-count.R >}}

{{< include _examples/figure-table/_code-snippets/species-year.R >}}
``` 
````
 
## Python
 
````{.markdown}
```{{python}}
#| label: tbl-species-count
#| tbl-cap: "Number of penguins sampled from each species in the Palmer Archipelago"
#| tbl-subcap: 
#|   - "Total"
#|   - "By year"

{{< include _examples/figure-table/_code-snippets/species-count.py >}}

{{< include _examples/figure-table/_code-snippets/species-year.py >}}
``` 
````
 
:::

An example of a code cell that produces two tables. Individual table captions are provided as an array to  `tbl-subcap`.

:::

![Result of rendering,  @fig-multiple-tables, a code cell with multiple tables.](images/figure-table-multiple-tables.png){#fig-multiple-tables-rendered fig-alt="Two tables, one above the other. Each table has a caption prefaced by '(a)' and '(b)' respectively. The overall caption is 'Table 1: Number of penguins sampled from each species in the Palmer Archipelago'."}

When rendered, the tables are placed together in a single "Table" where the overall caption is provided by `tbl-cap` and prefaced by "table 1:".
Each individual table in the panel has its own sub-caption prefaced by "(a)" and "(b)".
You can cross reference the entire panel with the `label`, e.g. `@tbl-soecies-count`, or individual tables by appending an index, e.g.  `@tbl-soecies-count-1` and `@tbl-soecies-count-2`.

Often the use of `tbl-subcap` is combined with layout options to arrange the tables in a specific way.
For example, the `layout-ncol` code cell option will arrange the tables in a specified number of columns. 
Adding the code cell option `layout-ncol: 2` to the above example would result in the tables laid out side-by-side rather than one above the other.

Using `tbl-subcap` is a quick way to create multi-panel tables, but as soon as you want some combination of: individual captions, a mix of figures and tables, to control placement on the page, or individual cross-references, we recommend using a single code cell for each output, and using the fenced divs syntax to label, caption and arrange them. 
You can learn more about this approach in @sec-figtab-layout.

## Troubleshooting {#sec-figtab-troubleshooting}

It's useful to think about the process of getting your figures/tables into the rendered document in three steps:

1. Execution of the code in your code cell that produces your figure/table.

2. Translation of the code cell output into markdown, including saving the image file in the case of figures.

3. Rendering of the markdown to include the figure/table in the final output format.

To troubleshoot a computational figure or table that doesn't come out looking right, we suggest troubleshooting each of these steps in turn.
The following sections provide some tips for doing this.

### Execute your code interactively 

Execute the code cell interactively in your computational environment.
Be careful to ensure your local computational environment (interpreter versions and package versions) matche those used by Quarto. 
Check the figure or table looks like you expect. 
If it doesn't, you need to fix your code based on the documentation for the packages you are using.

### Examine intermediate markdown

The execution engine translates the output of your code cell into markdown.
A good way to see what it has done is to examine the intermediate markdown after the engine has finished.
Set `keep-md: true` in your document header:

```{.yaml filename="document.qmd"}
---
title: My Document
keep-md: true
---
```

Render your document, and then open the generated markdown file, `{filename}.{format}.md` file.
Find the relevant figure or table (e.g. by searching for its `label`) and examine it carefully.
When examining the intermediate markdown ask yourself:

* Is the format of the figure or table what you expect? 

* Is the content of the figure or table what you expect? Compare to the result of evaluating your code cells locally. For figures, use the image path in the markdown to find the image file in the `{filename}_files/figure-{format}/` folder, and open it directly. For tables, you'll need to rely on examing the HTML or markdown syntax.

* Is the surrounding markdown what you expect? For example, are the attributes present on the figure or table markdown? Are the correct classes on the surrounding fenced divs?

Tracking down problems here is tricky because they could be coming from the packages you are using, the engine, or the interaction between the two. 
Here are some strategies to help you isolate the source of the problem.

#### Explore package options

Some packages are Quarto (or `knitr`/`jupyter`) aware, and will adjust their output based on the context of your document.
Other packages may not be Quarto aware but will provide options that may force a format, or omit extranuous markup.
Check the documentation for your chosen package to see if/how it supports Quarto, and what options are available.

#### Separate code from markdown

Some code options, like `column` and the `layout*` options, 
don't have an impact on how your code produces your figures and tables, 
but instead on the markdown that surrounds them in the document.

If you are using these options,
a good first step is to pull apart the layout from the code that produces the figure or table.

Remove the layout options entirely, and check the tables and figures themselves look right.
Then, introduce the layout back in, but use the fenced div approach (as outlined in @sec-layout), rather than the code cell options.

#### Do the translation yourself 

If you can't figure out why you aren't getting the right markdown, you can consider doing the translation yourself.
Instead of your code cell producing a figure or table, have it produce the markdown to include the figure or table.

You'll need to set the code cell option `output: asis` to tell Quarto not to further process the output of your code cell.
Then write code to output text that is the markdown to include your figure or table.
For figures, you will need to save the image file with code, you will be responsible for setting the format, size, and path.

For example, if your code saves an image to a path defined in `image_path`, @fig-translate-yourself shows how to produce the markdown to include it.

::: {#fig-translate-yourself}

::: {.panel-tabset group="language"}

## R
 
````{.markdown}
```{{r}}
#| echo: false
#| output: asis

cat(paste0("![Caption](", image_path, "){#fig-plot1 fig-alt='Alt text'}\n"))
```
````
 
## Python
 
````{.markdown}
```{{python}}
#| echo: false
#| output: asis

print(f"![Caption]({image_path}){{#fig-plot1 fig-alt='Alt text'}}\n")
```
````
 
:::

Code cells that produce markdown to include a figure saved in the path defined in `image_path`.
:::

### Compare to a non-computational outputs

If you see no problems with your intermediate markdown, you should be able to reproduce your problem with a non-computational example.
Replace your executable code cells with markdown equivalents.
For example, save your figure as an image file, and include it with standard markdown image syntax.

You can use your intermediate markdown as a guide, but simplify as much as you can, while still reproducing your problem.
You have now elimated the computational environment as a source of the problem, so it's possibly a Quarto problem.
It's time to ask for help, see @sec-ask-for-help.


## To be covered somewhere else

* Interactive figures/tables

* Embedding figures/tables from other documents